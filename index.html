<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOEIC è½åŠ›æ¨¡æ“¬æ¸¬é©—</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #f4f6f8;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            color: #333;
        }
        .exam-paper {
            background: white;
            width: 90%;
            max-width: 600px;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border-top: 5px solid #2c3e50;
        }
        h2 { color: #2c3e50; margin-top: 0; font-size: 22px; }
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 14px;
            color: #7f8c8d;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        /* æ’­æ”¾æ§åˆ¶å€ */
        .audio-control {
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 6px;
            text-align: center;
            margin-bottom: 25px;
        }
        .play-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 25px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .play-btn:hover { background-color: #2980b9; }
        .play-btn:disabled { background-color: #bdc3c7; cursor: not-allowed; }

        /* é¡Œç›®å€ */
        .question-text {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .options-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .option-item {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.2s;
            text-align: left;
            font-size: 16px;
            position: relative;
        }
        .option-item:hover { background-color: #f9f9f9; border-color: #bbb; }
        
        /* ç­”é¡Œåé¥‹ */
        .correct { 
            background-color: #d4edda !important; 
            border-color: #c3e6cb !important; 
            color: #155724;
        }
        .wrong { 
            background-color: #f8d7da !important; 
            border-color: #f5c6cb !important; 
            color: #721c24;
        }
        
        /* è…³æœ¬é¡¯ç¤ºå€ (ç­”éŒ¯å¾Œé¡¯ç¤º) */
        #script-display {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff3cd;
            border-radius: 4px;
            font-size: 14px;
            line-height: 1.6;
            display: none; /* é è¨­éš±è— */
            color: #856404;
            border: 1px solid #ffeeba;
        }

        .next-btn {
            margin-top: 20px;
            background-color: #2c3e50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            float: right;
            display: none;
        }
    </style>
</head>
<body>

    <div class="exam-paper">
        <div class="status-bar">
            <span id="progress">Question 1 / 5</span>
            <span>Score: <b id="score">0</b></span>
        </div>

        <h2>Part 3/4 Simulation</h2>
        
        <div class="audio-control">
            <p style="margin-top:0; font-size:14px; color:#666;">Click play to listen to the conversation.</p>
            <button class="play-btn" id="playBtn" onclick="playAudio()">â–¶ Play Audio</button>
        </div>

        <div class="question-block">
            <div class="question-text" id="q-text">Loading...</div>
            <div class="options-list" id="options-container"></div>
        </div>

        <div id="script-display"></div>
        <button class="next-btn" id="nextBtn" onclick="nextQuestion()">Next Question â†’</button>
    </div>

    <script>
        // --------------------------------------------------
        // ğŸ“š é€²éšé¡Œåº« (æ¨¡æ“¬å¤šç›Šæƒ…å¢ƒ)
        // script: é›»è…¦å”¸çš„å…§å®¹ (ç©å®¶çœ‹ä¸åˆ°)
        // question: é¡Œç›®
        // options: å››å€‹é¸é …
        // answer: æ­£ç¢ºé¸é …çš„ç´¢å¼• (0=A, 1=B, 2=C, 3=D)
        // --------------------------------------------------
        const toeicData = [
            {
                script: "Good morning, this is Sarah from Human Resources. I'm calling to let you know that the start time for the orientation has been changed. It will now begin at 10 AM instead of 9 AM. Please check your email for the updated schedule.",
                question: "Why is the speaker calling?",
                options: [
                    "(A) To cancel a meeting",
                    "(B) To announce a schedule change",
                    "(C) To hire a new employee",
                    "(D) To ask for a report"
                ],
                answer: 1
            },
            {
                script: "Attention passengers. The express train to Central Station is delayed due to minor track maintenance. It is expected to arrive in approximately 15 minutes. We apologize for the inconvenience.",
                question: "What is the problem with the train?",
                options: [
                    "(A) It is fully booked",
                    "(B) It has been cancelled",
                    "(C) It is delayed",
                    "(D) It is arriving early"
                ],
                answer: 2
            },
            {
                script: "Mr. Henderson, could you please review the quarterly sales figures before the board meeting this afternoon? We noticed a slight decrease in revenue from the European market.",
                question: "What is Mr. Henderson asked to do?",
                options: [
                    "(A) Travel to Europe",
                    "(B) Attend a board meeting",
                    "(C) Review financial data",
                    "(D) Write a resignation letter"
                ],
                answer: 2
            },
            {
                script: "Hi, I'd like to return this printer. I bought it yesterday, but when I set it up, it keeps jamming paper. I have my receipt right here.",
                question: "What is the customer's complaint?",
                options: [
                    "(A) The printer is too expensive",
                    "(B) The printer is not working properly",
                    "(C) The receipt is lost",
                    "(D) The store is closed"
                ],
                answer: 1
            },
            {
                script: "We are pleased to announce that our company will be merging with TechStar Inc. next month. This partnership will allow us to expand our software services globally.",
                question: "What will happen next month?",
                options: [
                    "(A) The company will shut down",
                    "(B) The company will launch a new product",
                    "(C) The company will merge with another firm",
                    "(D) The company will fire employees"
                ],
                answer: 2
            }
        ];

        let currentIndex = 0;
        let score = 0;
        let isAnswered = false;

        const qText = document.getElementById('q-text');
        const optionsContainer = document.getElementById('options-container');
        const scriptDisplay = document.getElementById('script-display');
        const nextBtn = document.getElementById('nextBtn');
        const playBtn = document.getElementById('playBtn');
        const progressEl = document.getElementById('progress');
        const scoreEl = document.getElementById('score');

        function initGame() {
            currentIndex = 0;
            score = 0;
            scoreEl.innerText = 0;
            loadQuestion();
        }

        function loadQuestion() {
            isAnswered = false;
            scriptDisplay.style.display = 'none';
            nextBtn.style.display = 'none';
            playBtn.disabled = false;
            playBtn.innerHTML = "â–¶ Play Audio";
            
            const data = toeicData[currentIndex];
            progressEl.innerText = `Question ${currentIndex + 1} / ${toeicData.length}`;
            
            // é¡¯ç¤ºé¡Œç›®
            qText.innerText = data.question;
            
            // å»ºç«‹é¸é …
            optionsContainer.innerHTML = '';
            data.options.forEach((opt, idx) => {
                const div = document.createElement('div');
                div.className = 'option-item';
                div.innerText = opt;
                div.onclick = () => checkAnswer(div, idx);
                optionsContainer.appendChild(div);
            });
        }

        function playAudio() {
            // é˜²æ­¢é‡è¤‡é»æ“Š
            if(window.speechSynthesis.speaking) return;

            const data = toeicData[currentIndex];
            const utter = new SpeechSynthesisUtterance(data.script);
            
            utter.lang = 'en-US'; 
            utter.rate = 1.0; // èªé€Ÿï¼š1.0 æ˜¯æ­£å¸¸ï¼Œ0.9 ç¨æ…¢ï¼Œ1.1 ç¨å¿«
            utter.pitch = 1;
            
            playBtn.innerHTML = "ğŸ”Š Playing...";
            playBtn.disabled = true; // æ’­æ”¾ä¸­ç¦æ­¢é»æ“Š

            utter.onend = function() {
                playBtn.innerHTML = "â†º Replay Audio";
                playBtn.disabled = false;
            };

            window.speechSynthesis.speak(utter);
        }

        function checkAnswer(el, userIdx) {
            if (isAnswered) return;
            isAnswered = true;

            const data = toeicData[currentIndex];
            const options = document.querySelectorAll('.option-item');

            // åœæ­¢æ’­æ”¾è²éŸ³
            window.speechSynthesis.cancel();

            if (userIdx === data.answer) {
                el.classList.add('correct');
                score++;
                scoreEl.innerText = score;
            } else {
                el.classList.add('wrong');
                // é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ
                options[data.answer].classList.add('correct');
            }

            // é¡¯ç¤ºè½åŠ›ç¨¿ (æª¢è¨ç”¨)
            scriptDisplay.innerHTML = `<strong>ğŸ“ Audio Script:</strong><br>${data.script}`;
            scriptDisplay.style.display = 'block';
            
            // é¡¯ç¤ºä¸‹ä¸€é¡ŒæŒ‰éˆ•
            nextBtn.style.display = 'block';
        }

        function nextQuestion() {
            currentIndex++;
            if (currentIndex < toeicData.length) {
                loadQuestion();
            } else {
                // çµç®—ç•«é¢
                document.querySelector('.exam-paper').innerHTML = `
                    <div style="text-align:center;">
                        <h2>Test Complete!</h2>
                        <p style="font-size:20px;">Your Score: <strong>${score} / ${toeicData.length}</strong></p>
                        <p>${score >= 4 ? "ğŸ† Excellent! You are ready for TOEIC." : "Keep practicing!"}</p>
                        <button class="next-btn" style="float:none; display:inline-block;" onclick="location.reload()">Try Again</button>
                    </div>
                `;
            }
        }

        // å•Ÿå‹•
        initGame();
    </script>
</body>
</html>
